@page
@model NorthwindApp.Pages.PrivacyModel

@{
    ViewData["Title"] = "Privacy Policy";
}
 <iframe title="Avg Montly Users" width="1140" height="600" src="https://app.powerbi.com/reportEmbed?reportId=18c78d2a-3e4b-4d3f-96a4-c4e6fe36ccda&autoAuth=true&embeddedDemo=true" frameborder="0" allowFullScreen="true"></iframe>
@*
<iframe title="Google Analytics" width="1140" height="600" src="https://app.powerbi.com/reportEmbed?reportId=de43743e-ddab-4ba5-9901-912fe13c718a&autoAuth=true" frameborder="0" allowFullScreen="true"></iframe> *@
@* 
 <script src="https://app.powerbi.com/reportEmbed?reportId=18c78d2a-3e4b-4d3f-96a4-c4e6fe36ccda&autoAuth=true&ctid=fde5a983-caa8-45ba-9dc0-e816e2c04004" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<iframe title="Avg Montly Users" class="row" width="1200" height="800" resize="true" src="https://app.powerbi.com/reportEmbed?reportId=18c78d2a-3e4b-4d3f-96a4-c4e6fe36ccda&autoAuth=true&ctid=fde5a983-caa8-45ba-9dc0-e816e2c04004" frameborder="0" allowFullScreen="true"></iframe>
 *@
@* <script src="https://app.powerbi.com/reportEmbed?reportId=18c78d2a-3e4b-4d3f-96a4-c4e6fe36ccda&autoAuth=true&ctid=de43743e-ddab-4ba5-9901-912fe13c718a" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<iframe title="Google Analytics" width="1200" height="800" resize="true" src="https://app.powerbi.com/reportEmbed?reportId=de43743e-ddab-4ba5-9901-912fe13c718a&autoAuth=true"></iframe>
 *@
<script>
    // <iframe title="Avg Montly Users" width="1140" height="541.25" src="https://app.powerbi.com/reportEmbed?reportId=18c78d2a-3e4b-4d3f-96a4-c4e6fe36ccda&autoAuth=true&embeddedDemo=true" frameborder="0" allowFullScreen="true"></iframe>

    let loadedResolve, reportLoaded = new Promise((res, rej) => { loadedResolve = res; });
    let renderedResolve, reportRendered = new Promise((res, rej) => { renderedResolve = res; });

    // Get models. models contains enums that can be used.
    models = window['powerbi-client'].models;

    // Embed a Power BI report in the given HTML element with the given configurations
    // Read more about how to embed a Power BI report in your application here: https://go.microsoft.com/fwlink/?linkid=2153590
    function embedPowerBIReport() {
        /*-----------------------------------------------------------------------------------+
        |    Don't change these values here: access token, embed URL and report ID.          |
        |    To make changes to these values:                                                |
        |    1. Save any other code changes to a text editor, as these will be lost.         |
        |    2. Select 'Start over' from the ribbon.                                         |
        |    3. Select a report or use an embed token.                                       |
        +-----------------------------------------------------------------------------------*/
        // Read embed application token
        let accessToken = EMBED_ACCESS_TOKEN;

        // Read embed URL
        let embedUrl = EMBED_URL;

        // Read report Id
        let embedReportId = REPORT_ID;

        // Read embed type from radio
        let tokenType = TOKEN_TYPE;

        // We give All permissions to demonstrate switching between View and Edit mode and saving report.
        let permissions = models.Permissions.All;

        // Create the embed configuration object for the report
        // For more information see https://go.microsoft.com/fwlink/?linkid=2153590
        let config = {
            type: 'report',
            tokenType: tokenType == '0' ? models.TokenType.Aad : models.TokenType.Embed,
            accessToken: accessToken,
            embedUrl: embedUrl,
            id: embedReportId,
            permissions: permissions,
            settings: {
                panes: {
                    filters: {
                        visible: true
                    },
                    pageNavigation: {
                        visible: true
                    }
                },
                bars: {
                    statusBar: {
                        visible: true
                    }
                }
            }
        };

        // Get a reference to the embedded report HTML element
        let embedContainer = $('#embedContainer')[0];

        // Embed the report and display it within the div container.
        report = powerbi.embed(embedContainer, config);

        // report.off removes all event handlers for a specific event
        report.off("loaded");

        // report.on will add an event handler
        report.on("loaded", function () {
            loadedResolve();
            report.off("loaded");
        });

        // report.off removes all event handlers for a specific event
        report.off("error");

        report.on("error", function (event) {
            console.log(event.detail);
        });

        // report.off removes all event handlers for a specific event
        report.off("rendered");

        // report.on will add an event handler
        report.on("rendered", function () {
            renderedResolve();
            report.off("rendered");
        });
    }

    embedPowerBIReport();// Reload the displayed report
    try {
        await report.reload();
    }
    catch (errors) {
        console.log(errors);
    }

    await reportLoaded;

    // Insert here the code you want to run after the report is loaded

    await reportRendered;

    // Insert here the code you want to run after the report is rendered

    // Switch to view mode.
    report.switchMode("view");

    // Switch to edit mode.
    report.switchMode("edit");

    // Save report
    // Note: The sample report can’t be saved.
    report.save();

    let saveAsParameters = {
        name: "newReport"
    };

    // SaveAs report
    // Note: The sample report can’t be saved.
    report.saveAs(saveAsParameters);


    // report.off removes all event handlers for a specific event
    report.off("saved");

    // report.on will add an event handler which prints to Log window.
    report.on("saved", function (event) {
        if (event.detail.saveAs) {
            console.log(event.detail, '\nIn order to interact with the new report, create a new token and load the new report');
        }
        else {
            console.log(event.detail);
        }
    });

    console.log("Save/SaveAs the report to see the saved event.");


    // Displays the report in full screen mode.
    report.fullscreen();

    // Get the current active page
    try {
        const activePage = await report.getActivePage();

        console.log("The active page is \"" + activePage.name + "\" with display name \"" + activePage.displayName + "\"");
    }
    catch (errors) {
        console.log(errors);
    }

    const base64Icon = "data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEwAACxMBAJqcGAAAAu9JREFUeJzt3U9OE2Ech/FnSiKsXbh340pg5Qk8gofAY3gGtBqWXsKNIR5BF0ZkQ9h6A2pC62LAEP5ITdv3R+f7fJJ3QUh4ZzpPmaaZmReGZxf4ABwDE2C24Jhc/K33wE7D/dB/2gIOgCmLH/S7xhQYA5uN9klz2gK+sLoDf30cXsypB+KAdgf/coyb7Jnutctq/+3/63Sw3WD/VmpUvQFL8BroCubtgL2CeXXNMe3f/ZfjqMH+rVTFO2fZJsCjwrnX+sPgEAKYFc+/1q/hED4DaAEGEM4AwhlAOAMIZwDhDCCcAYQzgHAGEM4AwhlAOAMIZwDhDCCcAYQzgHAGEM4AwhlAOAMIZwDhDCCcAYQzgHAGEM4AwhlAOAMIZwDhDCCcAYQzgHAGEM4AwhlAOAMIZwDhDCDcbQEs+3n7qx7Vqvf/vjH3egctnrfvqB13rnfQ+nn7jtrxd72DDXpj4BVK8RR4DHzq6M/5X1nzZ97qv82A3Q3gDfCidltUoAOmHf0nxGfFG6MaPztqn7evWpOO/lygUH4TGM4AwhlAOAMIZwDhDCCcAYQzgHAGEM4AwhlAOAMIZwDhDCCcAYQbAb+rN0JlJiPgtHorVOZkRH+NuDIddvS3C33Dy8LTTLm4LPwX8AQvDU/zDvh4+cMm/amg+pYlR5vxmVuuBN+iv0XMm0OHO86Bfa4c/NvO+9vAHvCS/h6yG3eSaq1MgBP6//AHwPervxzCB79Z8fxr/Rr6TWA4AwhnAOEMIJwBhDOAcAYQzgDCGUA4AwhnAOEMIJwBhDOAcAYQzgDCGUA4AwhnAOEMIJwBhDOAcAYQzgDCGUA4AwhnAOEMIJwBhDOAcAYQzgDCGUA4AwhnAOEMIJwBhDOAcAYQbggBVK53MCmceymGEMBp4dwnhXMvxRACqFzvwLUWHoAdah5wfQ48b7B/msOY9gHsN9kzzaX1ege3Pm9ftVqsd3Djeft6eLbpl0M5As5Y/KCfAT+AtwzwnP8HNwiKJyPkCoYAAAAASUVORK5CYII=";

    // The new settings that you want to apply to the report.
    const newSettings = {
        extensions: [
            {
                command: {
                    name: "extension command",
                    title: "Extend commands",
                    icon: base64Icon,
                    extend: {
                        // Define visualOptionsMenu to extend options menu
                        visualOptionsMenu: {
                            // Define title to override default title.
                            // You can override default icon as well.
                            title: "Extend options menu",
                        }
                    }
                }
            }
        ]
    };

    // Update the settings by passing in the new settings you have configured.
    try {
        await report.updateSettings(newSettings);
    }
    catch (error) {
        console.log(error);
    }

    // report.off removes all event handlers for a specific event
    report.off("commandTriggered");

    // report.on will add an event handler to commandTriggered event which prints to console window.
    report.on("commandTriggered", function (event) {
        let commandDetails = event.detail;
        console.log("Event - commandTriggered:\n", commandDetails);
    });

    // Select Run and open options menu to see new added items.
    // Click on menu items added and you should see an entry in the Log window.

    console.log("Open visual options menu by clicking the three dots icon and click on added items to see events in Log window.");

    try {
        await report.removeOptionsMenuCommand("extension command", "Extend options menu");
    }
    catch (error) {
        if (error == "PowerBIEntityNotFound") {
            console.log("Options menu is undefined. Please run 'Extend options menu' first.")
        }
        else {
            console.log(error);
        }
    }
    // The new settings that you want to apply to the report.
    const newSettings = {
        extensions: [
            {
                command: {
                    name: "extension command",
                    title: "Extend command",
                    extend: {
                        // Define visualContextMenu to extend context menu.
                        visualContextMenu: {
                            // Define title to override default title.
                            //You can override default icon as well.
                            title: "Extend context menu",
                        }
                    }
                }
            }
        ]
    };

    // Update the settings by passing in the new settings you have configured.
    try {
        await report.updateSettings(newSettings);
    }
    catch (error) {
        console.log(error);
    }

    // Build the sort request.
    // For more information, See https://go.microsoft.com/fwlink/?linkid=2153365
    const sortByRequest = {
        orderBy: {
            table: "Geo",
            column: "Region"
        },
        direction: models.SortDirection.Descending
    };

    // Retrieve the page collection and get the visuals for the active page.
    try {
        const pages = await report.getPages();

        // Retrieve the page that contain the visual. For the sample report it will be the active page
        let page = pages.filter(function (page) {
            return page.isActive
        })[0];

        const visuals = await page.getVisuals();

        // Retrieve the target visual.
        let visual = visuals.filter(function (visual) {
            return visual.name === "VisualContainer6";
        })[0];

        // Sort the visual's data by direction and data field.
        await visual.sortBy(sortByRequest);
        console.log("\"Total Category Volume Over Time by Region\" visual was sorted according to the request.");
    }
    catch (errors) {
        console.log(errors);
    }
    // Displays the dashboard in full screen mode.
    dashboard.fullscreen();


</script>